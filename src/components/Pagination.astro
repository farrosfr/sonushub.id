---
interface Props {
  currentPage: number;
  totalPages: number;
  baseUrl: string;
  searchParams: URLSearchParams;
}

const { currentPage, totalPages, baseUrl, searchParams } = Astro.props;

const createPageUrl = (page: number) => {
    const params = new URLSearchParams(searchParams);
    params.set('page', page.toString());
    return `${baseUrl}?${params.toString()}`;
};

const prevPage = currentPage > 1 ? currentPage - 1 : null;
const nextPage = currentPage < totalPages ? currentPage + 1 : null;

// Logic to create a list of pages to show, e.g., [1, '...', 4, 5, 6, '...', 10]
const pagesToShow: (string | number)[] = [];
const pagesRange = 2; // how many pages to show around current page

if (totalPages > 1) {
    if (totalPages <= 5) {
        // show all pages if 5 or less
        for (let i = 1; i <= totalPages; i++) {
            pagesToShow.push(i);
        }
    } else {
        // more than 5 pages, so we need to truncate
        pagesToShow.push(1); // always show first page

        let start = Math.max(2, currentPage - pagesRange);
        let end = Math.min(totalPages - 1, currentPage + pagesRange);

        if (currentPage - pagesRange > 2) {
            pagesToShow.push('...');
        }

        for (let i = start; i <= end; i++) {
            pagesToShow.push(i);
        }

        if (currentPage + pagesRange < totalPages - 1) {
            pagesToShow.push('...');
        }

        pagesToShow.push(totalPages); // always show last page
    }
}
---

{totalPages > 1 && (
<nav class="mt-12 flex justify-center" aria-label="Pagination">
  <ul class="flex items-center -space-x-px h-10 text-base">
    {prevPage && (
      <li>
        <a
          href={createPageUrl(prevPage)}
          class="flex items-center justify-center px-4 h-10 ms-0 leading-tight text-gray-500 bg-white border border-e-0 border-gray-300 rounded-s-lg hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white"
        >
          <span class="sr-only">Previous</span>
          <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 6 10">
            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 1 1 5l4 4"/>
          </svg>
        </a>
      </li>
    )}
    
    {pagesToShow.map(page => (
        <li>
            {typeof page === 'number' ? (
                <a
                    href={createPageUrl(page)}
                    class:list={[
                        "flex items-center justify-center px-4 h-10 leading-tight border",
                        {
                            'text-blue-600 bg-blue-50 border-blue-300 hover:bg-blue-100 hover:text-blue-700 dark:bg-gray-700 dark:border-gray-600 dark:text-white': currentPage === page,
                            'text-gray-500 bg-white border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white': currentPage !== page
                        }
                    ]}
                    aria-current={currentPage === page ? 'page' : undefined}
                >
                    {page}
                </a>
            ) : (
                <span class="flex items-center justify-center px-4 h-10 leading-tight text-gray-500 bg-white border border-gray-300 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400">...</span>
            )}
        </li>
    ))}

    {nextPage && (
      <li>
        <a
          href={createPageUrl(nextPage)}
          class="flex items-center justify-center px-4 h-10 leading-tight text-gray-500 bg-white border border-gray-300 rounded-e-lg hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white"
        >
          <span class="sr-only">Next</span>
          <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 6 10">
              <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 9 4-4-4-4"/>
          </svg>
        </a>
      </li>
    )}
  </ul>
</nav>
)}
